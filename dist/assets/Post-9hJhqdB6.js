import{r as a,u as k,a as T,b as S,s as L,d as Z,e as ee,N as se,c as te,j as e,L as ae,K as re,H as R,M as D,S as F,O as le,P as ie,Q as ne,T as oe,V as ce}from"./index-rrPmFSZK.js";import{M as de,B as ue,F as me,G as xe,I as he,f as fe}from"./index-DTZsAICM.js";import{u as ge}from"./useSavedpost-G6qqAXys.js";const ke=s=>{const[c,x]=a.useState(!0),[u,o]=a.useState(null),h=k(m=>{var r;return((r=m.post.likes.find(i=>i.id===s))==null?void 0:r.isLiked)||!1}),l=k(m=>{var r;return((r=m.post.likes.find(i=>i.id===s))==null?void 0:r.likeCount)||0}),f=T();return a.useEffect(()=>{if(!s)return;l||(async()=>{var r,i;x(!0);try{const d=await S.get(`/post/getlikes?postId=${s}`);f(L({type:"SET_LIKE",payload:{id:s,likeCount:d.data.likesCount,isLiked:d.data.isCurrUserLiked}}))}catch(d){o(((i=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:i.message)||"Something went wrong")}finally{x(!1)}})()},[s,f,l]),{likeCount:l,loading:c,error:u,isLiked:h,likePost:async()=>{if(!s)return;const m=h?l-1:l+1;try{f(L({type:"SET_LIKE",payload:{id:s,likeCount:m,isLiked:!h}}));const r=await S.post(`/post/like?postId=${s}`)}catch{f(L({type:"SET_LIKE",payload:{id:s,likeCount:l,isLiked:h}})),o("Failed to update like status")}}}},pe=s=>{const c=["jpg","jpeg","png","gif","bmp","webp"],x=["mp4","mov","avi","mkv","webm","flv"],u=s==null?void 0:s.toLowerCase();return c.some(o=>u.includes(o))?"image":x.some(o=>u.includes(o))?"video":"unknown"};function be({post:s}){var M,O,$;const c=Z(),{isLoggedIn:x}=ee(),[u,o]=a.useState(!0),[h,l]=a.useState(!1),[f,p]=a.useState(!1),[m,r]=a.useState(!1),{likeCount:i,isLiked:d,likePost:B}=ke(s._id),j=k(t=>t.auth.isMute),I=T(),{getComment:je,createComment:U,deleteComment:V,comments:v}=se(s._id),w=a.useRef(null),N=a.useRef(null),[b,y]=a.useState({addLoader:!1,removeLoader:!1}),{addSavedPost:A,removeSavedPost:H}=ge(),E=k(t=>t.savedPosts.saved_Posts);a.useEffect(()=>{const t=E.find(n=>n.postId._id===s._id);p(!!t)},[E]);const[K,P]=a.useState(!1),g=te(()=>o(!0),()=>o(!1),{threshold:.6});a.useEffect(()=>{g.current&&(u?g.current.play():g.current.pause())},[u]);const C=async()=>{await B(s.id)},z=pe(s.file.fileType),G=()=>{I(ce(!j))},[Q,_]=a.useState(!1),X=t=>{b.removeLoader||(y(n=>({...n,removeLoader:!0})),V(t),_(!1),y(n=>({...n,removeLoader:!1})))};a.useEffect(()=>{const t=n=>{w.current&&!w.current.contains(n.target)&&r(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),a.useEffect(()=>{const t=n=>{N.current&&!N.current.contains(n.target)&&l(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]);const Y=()=>{A(s._id),l(!1)},q=()=>{H(s._id),l(!1)},J=async()=>{try{const t=await S.post(`/post/report-post?id=${s._id}`)}catch(t){alert(t.response.data.message||"Something went wrong!")}finally{l(!1)}},W=()=>{l(!h)};return e.jsxs("div",{className:" relative  w-full max-w-lg bg-inherit border dark:border-gray-700 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs(ae,{to:`/seller/${s.user._id}`,className:"flex items-center space-x-2",children:[e.jsx("img",{src:s.user.profilePicture,alt:s.user.fullName,className:"w-8 h-8 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold dark:text-white",children:s.user.fullName})]}),e.jsx("button",{onClick:W,className:"dark:text-white",children:e.jsx(de,{className:"cursor-pointer"})}),h&&e.jsx("div",{ref:N,className:"absolute top-0 right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-50 border dark:border-gray-700",children:e.jsxs("div",{className:"py-1",children:[f?e.jsxs("button",{onClick:q,className:"flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",children:[e.jsx(ue,{className:"w-5 h-5 mr-2"}),"UnSave"]}):e.jsxs("button",{onClick:Y,className:"flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",children:[e.jsx(re,{className:"w-5 h-5 mr-2"}),"Save"]}),e.jsxs("button",{onClick:J,className:"flex items-center px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",children:[e.jsx("span",{className:"material-icons-outlined text-lg mr-2",children:e.jsx(me,{className:"w-5 h-5"})}),"Report"]})]})})]}),e.jsxs("p",{className:"dark:text-white",style:{paddingLeft:"12px",paddingBottom:"8px",marginTop:"-8px"},children:[e.jsx("span",{className:"font-semibold"})," ",s.caption]}),e.jsx("div",{className:"relative",children:z==="video"?e.jsxs("div",{onClick:()=>o(!1),onDoubleClick:C,className:"relative min-w-full bg-black sm:min-w-96",children:[e.jsxs("video",{onClick:()=>c(`/reels/${s._id}`),ref:g,className:"w-full max-h-[60vh] objectcovernow",muted:j,loop:!0,autoPlay:u,children:[e.jsx("source",{src:s.file.url,type:`video/${s.file.fileType}`}),"Your browser does not support the video tag."]}),e.jsx("div",{className:"absolute p-4 bottom-2 right-2 z-50",onClick:G,children:j?e.jsx(he,{className:"text-white text-xl"}):e.jsx(xe,{className:"text-white text-xl"})})]}):e.jsx("img",{onClick:()=>c(`/reels/${s._id}`),onDoubleClick:C,src:s.file.url,alt:"Post Media",className:"w-full object-cover min-h-64 max-h-[500px]"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[x?e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:C,className:"transform active:scale-125 transition-transform duration-200",children:e.jsx(R,{className:`w-6 h-6 ${d?"text-red-500 fill-current":"dark:text-white"}`})})," ",e.jsxs("span",{style:{marginLeft:"6px",fontSize:"17px"},className:" dark:text-white",children:[i," ",i>1?"Likes":"Like"]})," "]}):e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>c("/signup"),className:"transform active:scale-125 transition-transform duration-200",children:e.jsx(R,{className:`w-6 h-6 ${d?"text-red-500 fill-current":"dark:text-white"}`})})," ",e.jsxs("span",{className:"font-semibold dark:text-white",children:[i," ",i>1?"Likes":"Like"]})," "]}),x?e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>r(t=>!t),children:e.jsx(D,{className:"w-6 h-6 dark:text-white"})}),e.jsx("button",{onClick:()=>P(!0),children:e.jsx(F,{className:"w-6 h-6 dark:text-white"})})," "]}):e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>c("/signup"),children:e.jsx(D,{className:"w-6 h-6 dark:text-white"})})," ",e.jsx("button",{onClick:()=>c("/signup"),children:e.jsx(F,{className:"w-6 h-6 dark:text-white"})})]})]}),(M=s.user)!=null&&M.longitude&&((O=s.user)!=null&&O.lattitude)?e.jsx(le,{link:($=s.user)==null?void 0:$.googleMapLink,createdDate:s.createdAt,longitude:s.user.longitude,lattitude:s.user.lattitude}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"text-gray-500 dark:text-gray-400 text-sm",onClick:()=>r(t=>!t),children:"View all comments"}),e.jsx("p",{className:"text-gray-400 text-xs uppercase",children:fe(s.createdAt)})]}),m?e.jsxs("div",{ref:w,children:[v&&v.length?v.map(t=>e.jsxs("div",{className:"flex items-start space-x-4 mb-2",children:[e.jsx("img",{src:t.user.profilePicture,alt:t.user.fullName,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{className:"flex-grow h-full items-start flex flex-col",children:[e.jsx("p",{className:"font-semibold dark:text-white",children:t.user.fullName}),e.jsx("p",{className:"dark:text-white",children:t.text})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"dark:text-white text-black text-lg cursor-pointer",onClick:()=>_(n=>n===t._id?!1:t._id)}),Q===t._id&&e.jsx("div",{className:"absolute top-full right-[21px] mt-[-24px] rounded-sm",children:e.jsx("p",{className:" text-white font-semibold rounded-sm cursor-pointer text-sm p-2 bg-red-500  hover:underline",onClick:()=>X(t._id),children:b.removeLoader?"loading...":"Delete"})})]})]},t._id)):null,e.jsx(ne,{postId:s.id,createComment:U,loader:b,setLoader:y})]}):null,e.jsx(oe,{isOpen:K,onClose:()=>P(!1),reelId:s._id})]})]})}export{be as default,pe as identifyMediaType};
